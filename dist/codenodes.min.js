!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).codenodes=t()}}(function(){return function t(e,n,o){function i(r,a){if(!n[r]){if(!e[r]){var u="function"==typeof require&&require;if(!a&&u)return u(r,!0);if(s)return s(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[r]={exports:{}};e[r][0].call(c.exports,function(t){var n=e[r][1][t];return i(n||t)},c,c.exports,t,e,n,o)}return n[r].exports}for(var s="function"==typeof require&&require,r=0;r<o.length;r++)i(o[r]);return i}({1:[function(t,e,n){var o=t("./svg-pan-zoom.js");e.exports=o},{"./svg-pan-zoom.js":4}],2:[function(t,e,n){var o=t("./svg-utilities");e.exports={enable:function(t){var e=t.svg.querySelector("defs");if(e||(e=document.createElementNS(o.svgNS,"defs"),t.svg.appendChild(e)),!e.querySelector("style#svg-pan-zoom-controls-styles")){var n=document.createElementNS(o.svgNS,"style");n.setAttribute("id","svg-pan-zoom-controls-styles"),n.setAttribute("type","text/css"),n.textContent=".svg-pan-zoom-control { cursor: pointer; fill: black; fill-opacity: 0.333; } .svg-pan-zoom-control:hover { fill-opacity: 0.8; } .svg-pan-zoom-control-background { fill: white; fill-opacity: 0.5; } .svg-pan-zoom-control-background { fill-opacity: 0.8; }",e.appendChild(n)}var i=document.createElementNS(o.svgNS,"g");i.setAttribute("id","svg-pan-zoom-controls"),i.setAttribute("transform","translate("+(t.width-70)+" "+(t.height-76)+") scale(0.75)"),i.setAttribute("class","svg-pan-zoom-control"),i.appendChild(this._createZoomIn(t)),i.appendChild(this._createZoomReset(t)),i.appendChild(this._createZoomOut(t)),t.svg.appendChild(i),t.controlIcons=i},_createZoomIn:function(t){var e=document.createElementNS(o.svgNS,"g");e.setAttribute("id","svg-pan-zoom-zoom-in"),e.setAttribute("transform","translate(30.5 5) scale(0.015)"),e.setAttribute("class","svg-pan-zoom-control"),e.addEventListener("click",function(){t.getPublicInstance().zoomIn()},!1),e.addEventListener("touchstart",function(){t.getPublicInstance().zoomIn()},!1);var n=document.createElementNS(o.svgNS,"rect");n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("width","1500"),n.setAttribute("height","1400"),n.setAttribute("class","svg-pan-zoom-control-background"),e.appendChild(n);var i=document.createElementNS(o.svgNS,"path");return i.setAttribute("d","M1280 576v128q0 26 -19 45t-45 19h-320v320q0 26 -19 45t-45 19h-128q-26 0 -45 -19t-19 -45v-320h-320q-26 0 -45 -19t-19 -45v-128q0 -26 19 -45t45 -19h320v-320q0 -26 19 -45t45 -19h128q26 0 45 19t19 45v320h320q26 0 45 19t19 45zM1536 1120v-960 q0 -119 -84.5 -203.5t-203.5 -84.5h-960q-119 0 -203.5 84.5t-84.5 203.5v960q0 119 84.5 203.5t203.5 84.5h960q119 0 203.5 -84.5t84.5 -203.5z"),i.setAttribute("class","svg-pan-zoom-control-element"),e.appendChild(i),e},_createZoomReset:function(t){var e=document.createElementNS(o.svgNS,"g");e.setAttribute("id","svg-pan-zoom-reset-pan-zoom"),e.setAttribute("transform","translate(5 35) scale(0.4)"),e.setAttribute("class","svg-pan-zoom-control"),e.addEventListener("click",function(){t.getPublicInstance().reset()},!1),e.addEventListener("touchstart",function(){t.getPublicInstance().reset()},!1);var n=document.createElementNS(o.svgNS,"rect");n.setAttribute("x","2"),n.setAttribute("y","2"),n.setAttribute("width","182"),n.setAttribute("height","58"),n.setAttribute("class","svg-pan-zoom-control-background"),e.appendChild(n);var i=document.createElementNS(o.svgNS,"path");i.setAttribute("d","M33.051,20.632c-0.742-0.406-1.854-0.609-3.338-0.609h-7.969v9.281h7.769c1.543,0,2.701-0.188,3.473-0.562c1.365-0.656,2.048-1.953,2.048-3.891C35.032,22.757,34.372,21.351,33.051,20.632z"),i.setAttribute("class","svg-pan-zoom-control-element"),e.appendChild(i);var s=document.createElementNS(o.svgNS,"path");return s.setAttribute("d","M170.231,0.5H15.847C7.102,0.5,0.5,5.708,0.5,11.84v38.861C0.5,56.833,7.102,61.5,15.847,61.5h154.384c8.745,0,15.269-4.667,15.269-10.798V11.84C185.5,5.708,178.976,0.5,170.231,0.5z M42.837,48.569h-7.969c-0.219-0.766-0.375-1.383-0.469-1.852c-0.188-0.969-0.289-1.961-0.305-2.977l-0.047-3.211c-0.03-2.203-0.41-3.672-1.142-4.406c-0.732-0.734-2.103-1.102-4.113-1.102h-7.05v13.547h-7.055V14.022h16.524c2.361,0.047,4.178,0.344,5.45,0.891c1.272,0.547,2.351,1.352,3.234,2.414c0.731,0.875,1.31,1.844,1.737,2.906s0.64,2.273,0.64,3.633c0,1.641-0.414,3.254-1.242,4.84s-2.195,2.707-4.102,3.363c1.594,0.641,2.723,1.551,3.387,2.73s0.996,2.98,0.996,5.402v2.32c0,1.578,0.063,2.648,0.19,3.211c0.19,0.891,0.635,1.547,1.333,1.969V48.569z M75.579,48.569h-26.18V14.022h25.336v6.117H56.454v7.336h16.781v6H56.454v8.883h19.125V48.569z M104.497,46.331c-2.44,2.086-5.887,3.129-10.34,3.129c-4.548,0-8.125-1.027-10.731-3.082s-3.909-4.879-3.909-8.473h6.891c0.224,1.578,0.662,2.758,1.316,3.539c1.196,1.422,3.246,2.133,6.15,2.133c1.739,0,3.151-0.188,4.236-0.562c2.058-0.719,3.087-2.055,3.087-4.008c0-1.141-0.504-2.023-1.512-2.648c-1.008-0.609-2.607-1.148-4.796-1.617l-3.74-0.82c-3.676-0.812-6.201-1.695-7.576-2.648c-2.328-1.594-3.492-4.086-3.492-7.477c0-3.094,1.139-5.664,3.417-7.711s5.623-3.07,10.036-3.07c3.685,0,6.829,0.965,9.431,2.895c2.602,1.93,3.966,4.73,4.093,8.402h-6.938c-0.128-2.078-1.057-3.555-2.787-4.43c-1.154-0.578-2.587-0.867-4.301-0.867c-1.907,0-3.428,0.375-4.565,1.125c-1.138,0.75-1.706,1.797-1.706,3.141c0,1.234,0.561,2.156,1.682,2.766c0.721,0.406,2.25,0.883,4.589,1.43l6.063,1.43c2.657,0.625,4.648,1.461,5.975,2.508c2.059,1.625,3.089,3.977,3.089,7.055C108.157,41.624,106.937,44.245,104.497,46.331z M139.61,48.569h-26.18V14.022h25.336v6.117h-18.281v7.336h16.781v6h-16.781v8.883h19.125V48.569z M170.337,20.14h-10.336v28.43h-7.266V20.14h-10.383v-6.117h27.984V20.14z"),s.setAttribute("class","svg-pan-zoom-control-element"),e.appendChild(s),e},_createZoomOut:function(t){var e=document.createElementNS(o.svgNS,"g");e.setAttribute("id","svg-pan-zoom-zoom-out"),e.setAttribute("transform","translate(30.5 70) scale(0.015)"),e.setAttribute("class","svg-pan-zoom-control"),e.addEventListener("click",function(){t.getPublicInstance().zoomOut()},!1),e.addEventListener("touchstart",function(){t.getPublicInstance().zoomOut()},!1);var n=document.createElementNS(o.svgNS,"rect");n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("width","1500"),n.setAttribute("height","1400"),n.setAttribute("class","svg-pan-zoom-control-background"),e.appendChild(n);var i=document.createElementNS(o.svgNS,"path");return i.setAttribute("d","M1280 576v128q0 26 -19 45t-45 19h-896q-26 0 -45 -19t-19 -45v-128q0 -26 19 -45t45 -19h896q26 0 45 19t19 45zM1536 1120v-960q0 -119 -84.5 -203.5t-203.5 -84.5h-960q-119 0 -203.5 84.5t-84.5 203.5v960q0 119 84.5 203.5t203.5 84.5h960q119 0 203.5 -84.5 t84.5 -203.5z"),i.setAttribute("class","svg-pan-zoom-control-element"),e.appendChild(i),e},disable:function(t){t.controlIcons&&(t.controlIcons.parentNode.removeChild(t.controlIcons),t.controlIcons=null)}}},{"./svg-utilities":5}],3:[function(t,e,n){var o=t("./svg-utilities"),i=t("./utilities"),s=function(t,e){this.init(t,e)};s.prototype.init=function(t,e){this.viewport=t,this.options=e,this.originalState={zoom:1,x:0,y:0},this.activeState={zoom:1,x:0,y:0},this.updateCTMCached=i.proxy(this.updateCTM,this),this.requestAnimationFrame=i.createRequestAnimationFrame(this.options.refreshRate),this.viewBox={x:0,y:0,width:0,height:0},this.cacheViewBox();var n=this.processCTM();this.setCTM(n),this.updateCTM()},s.prototype.cacheViewBox=function(){var t=this.options.svg.getAttribute("viewBox");if(t){var e=t.split(/[\s\,]/).filter(function(t){return t}).map(parseFloat);this.viewBox.x=e[0],this.viewBox.y=e[1],this.viewBox.width=e[2],this.viewBox.height=e[3];var n=Math.min(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height);this.activeState.zoom=n,this.activeState.x=(this.options.width-this.viewBox.width*n)/2,this.activeState.y=(this.options.height-this.viewBox.height*n)/2,this.updateCTMOnNextFrame(),this.options.svg.removeAttribute("viewBox")}else this.simpleViewBoxCache()},s.prototype.simpleViewBoxCache=function(){var t=this.viewport.getBBox();this.viewBox.x=t.x,this.viewBox.y=t.y,this.viewBox.width=t.width,this.viewBox.height=t.height},s.prototype.getViewBox=function(){return i.extend({},this.viewBox)},s.prototype.processCTM=function(){var t=this.getCTM();if(this.options.fit||this.options.contain){var e;e=this.options.fit?Math.min(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height):Math.max(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height),t.a=e,t.d=e,t.e=-this.viewBox.x*e,t.f=-this.viewBox.y*e}if(this.options.center){var n=.5*(this.options.width-(this.viewBox.width+2*this.viewBox.x)*t.a),o=.5*(this.options.height-(this.viewBox.height+2*this.viewBox.y)*t.a);t.e=n,t.f=o}return this.originalState.zoom=t.a,this.originalState.x=t.e,this.originalState.y=t.f,t},s.prototype.getOriginalState=function(){return i.extend({},this.originalState)},s.prototype.getState=function(){return i.extend({},this.activeState)},s.prototype.getZoom=function(){return this.activeState.zoom},s.prototype.getRelativeZoom=function(){return this.activeState.zoom/this.originalState.zoom},s.prototype.computeRelativeZoom=function(t){return t/this.originalState.zoom},s.prototype.getPan=function(){return{x:this.activeState.x,y:this.activeState.y}},s.prototype.getCTM=function(){var t=this.options.svg.createSVGMatrix();return t.a=this.activeState.zoom,t.b=0,t.c=0,t.d=this.activeState.zoom,t.e=this.activeState.x,t.f=this.activeState.y,t},s.prototype.setCTM=function(t){var e=this.isZoomDifferent(t),n=this.isPanDifferent(t);if(e||n){if(e&&(!1===this.options.beforeZoom(this.getRelativeZoom(),this.computeRelativeZoom(t.a))?(t.a=t.d=this.activeState.zoom,e=!1):(this.updateCache(t),this.options.onZoom(this.getRelativeZoom()))),n){var o=this.options.beforePan(this.getPan(),{x:t.e,y:t.f}),s=!1,r=!1;!1===o?(t.e=this.getPan().x,t.f=this.getPan().y,s=r=!0):i.isObject(o)&&(!1===o.x?(t.e=this.getPan().x,s=!0):i.isNumber(o.x)&&(t.e=o.x),!1===o.y?(t.f=this.getPan().y,r=!0):i.isNumber(o.y)&&(t.f=o.y)),s&&r||!this.isPanDifferent(t)?n=!1:(this.updateCache(t),this.options.onPan(this.getPan()))}(e||n)&&this.updateCTMOnNextFrame()}},s.prototype.isZoomDifferent=function(t){return this.activeState.zoom!==t.a},s.prototype.isPanDifferent=function(t){return this.activeState.x!==t.e||this.activeState.y!==t.f},s.prototype.updateCache=function(t){this.activeState.zoom=t.a,this.activeState.x=t.e,this.activeState.y=t.f},s.prototype.pendingUpdate=!1,s.prototype.updateCTMOnNextFrame=function(){this.pendingUpdate||(this.pendingUpdate=!0,this.requestAnimationFrame.call(window,this.updateCTMCached))},s.prototype.updateCTM=function(){var t=this.getCTM();o.setCTM(this.viewport,t,this.defs),this.pendingUpdate=!1,this.options.onUpdatedCTM&&this.options.onUpdatedCTM(t)},e.exports=function(t,e){return new s(t,e)}},{"./svg-utilities":5,"./utilities":7}],4:[function(t,e,n){var o=t("./uniwheel"),i=t("./control-icons"),s=t("./utilities"),r=t("./svg-utilities"),a=t("./shadow-viewport"),u=function(t,e){this.init(t,e)},l={viewportSelector:".svg-pan-zoom_viewport",panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,mouseWheelZoomEnabled:!0,preventMouseEventsDefault:!0,zoomScaleSensitivity:.1,minZoom:.5,maxZoom:10,fit:!0,contain:!1,center:!0,refreshRate:"auto",beforeZoom:null,onZoom:null,beforePan:null,onPan:null,customEventsHandler:null,eventsListenerElement:null,onUpdatedCTM:null};u.prototype.init=function(t,e){var n=this;this.svg=t,this.defs=t.querySelector("defs"),r.setupSvgAttributes(this.svg),this.options=s.extend(s.extend({},l),e),this.state="none";var o=r.getBoundingClientRectNormalized(t);this.width=o.width,this.height=o.height,this.viewport=a(r.getOrCreateViewport(this.svg,this.options.viewportSelector),{svg:this.svg,width:this.width,height:this.height,fit:this.options.fit,contain:this.options.contain,center:this.options.center,refreshRate:this.options.refreshRate,beforeZoom:function(t,e){if(n.viewport&&n.options.beforeZoom)return n.options.beforeZoom(t,e)},onZoom:function(t){if(n.viewport&&n.options.onZoom)return n.options.onZoom(t)},beforePan:function(t,e){if(n.viewport&&n.options.beforePan)return n.options.beforePan(t,e)},onPan:function(t){if(n.viewport&&n.options.onPan)return n.options.onPan(t)},onUpdatedCTM:function(t){if(n.viewport&&n.options.onUpdatedCTM)return n.options.onUpdatedCTM(t)}});var u=this.getPublicInstance();u.setBeforeZoom(this.options.beforeZoom),u.setOnZoom(this.options.onZoom),u.setBeforePan(this.options.beforePan),u.setOnPan(this.options.onPan),u.setOnUpdatedCTM(this.options.onUpdatedCTM),this.options.controlIconsEnabled&&i.enable(this),this.lastMouseWheelEventTime=Date.now(),this.setupHandlers()},u.prototype.setupHandlers=function(){var t=this,e=null;if(this.eventListeners={mousedown:function(n){if(n.target instanceof SVGSVGElement){var o=t.handleMouseDown(n,e);return e=n,o}},touchstart:function(n){if(n.target instanceof SVGSVGElement){var o=t.handleMouseDown(n,e);return e=n,o}},mouseup:function(e){if(e.target instanceof SVGSVGElement)return t.handleMouseUp(e)},touchend:function(e){if(e.target instanceof SVGSVGElement)return t.handleMouseUp(e)},mousemove:function(e){if(e.target instanceof SVGSVGElement)return t.handleMouseMove(e)},touchmove:function(e){if(e.target instanceof SVGSVGElement)return t.handleMouseMove(e)},mouseleave:function(e){if(e.target instanceof SVGSVGElement)return t.handleMouseUp(e)},touchleave:function(e){if(e.target instanceof SVGSVGElement)return t.handleMouseUp(e)},touchcancel:function(e){if(e.target instanceof SVGSVGElement)return t.handleMouseUp(e)}},null!=this.options.customEventsHandler){this.options.customEventsHandler.init({svgElement:this.svg,eventsListenerElement:this.options.eventsListenerElement,instance:this.getPublicInstance()});var n=this.options.customEventsHandler.haltEventListeners;if(n&&n.length)for(var o=n.length-1;o>=0;o--)this.eventListeners.hasOwnProperty(n[o])&&delete this.eventListeners[n[o]]}for(var i in this.eventListeners)(this.options.eventsListenerElement||this.svg).addEventListener(i,this.eventListeners[i],!1);this.options.mouseWheelZoomEnabled&&(this.options.mouseWheelZoomEnabled=!1,this.enableMouseWheelZoom())},u.prototype.enableMouseWheelZoom=function(){if(!this.options.mouseWheelZoomEnabled){var t=this;this.wheelListener=function(e){return t.handleMouseWheel(e)},o.on(this.options.eventsListenerElement||this.svg,this.wheelListener,!1),this.options.mouseWheelZoomEnabled=!0}},u.prototype.disableMouseWheelZoom=function(){this.options.mouseWheelZoomEnabled&&(o.off(this.options.eventsListenerElement||this.svg,this.wheelListener,!1),this.options.mouseWheelZoomEnabled=!1)},u.prototype.handleMouseWheel=function(t){if(this.options.zoomEnabled&&"none"===this.state){this.options.preventMouseEventsDefault&&(t.preventDefault?t.preventDefault():t.returnValue=!1);var e=t.deltaY||1,n=Date.now()-this.lastMouseWheelEventTime,o=3+Math.max(0,30-n);this.lastMouseWheelEventTime=Date.now(),"deltaMode"in t&&0===t.deltaMode&&t.wheelDelta&&(e=0===t.deltaY?0:Math.abs(t.wheelDelta)/t.deltaY),e=-.3<e&&e<.3?e:(e>0?1:-1)*Math.log(Math.abs(e)+10)/o;var i=this.svg.getScreenCTM().inverse(),s=r.getEventPoint(t,this.svg).matrixTransform(i),a=Math.pow(1+this.options.zoomScaleSensitivity,-1*e);this.zoomAtPoint(a,s)}},u.prototype.zoomAtPoint=function(t,e,n){var o=this.viewport.getOriginalState();n?(t=Math.max(this.options.minZoom*o.zoom,Math.min(this.options.maxZoom*o.zoom,t)),t/=this.getZoom()):this.getZoom()*t<this.options.minZoom*o.zoom?t=this.options.minZoom*o.zoom/this.getZoom():this.getZoom()*t>this.options.maxZoom*o.zoom&&(t=this.options.maxZoom*o.zoom/this.getZoom());var i=this.viewport.getCTM(),s=e.matrixTransform(i.inverse()),r=this.svg.createSVGMatrix().translate(s.x,s.y).scale(t).translate(-s.x,-s.y),a=i.multiply(r);a.a!==i.a&&this.viewport.setCTM(a)},u.prototype.zoom=function(t,e){this.zoomAtPoint(t,r.getSvgCenterPoint(this.svg,this.width,this.height),e)},u.prototype.publicZoom=function(t,e){e&&(t=this.computeFromRelativeZoom(t)),this.zoom(t,e)},u.prototype.publicZoomAtPoint=function(t,e,n){if(n&&(t=this.computeFromRelativeZoom(t)),"SVGPoint"!==s.getType(e)){if(!("x"in e&&"y"in e))throw new Error("Given point is invalid");e=r.createSVGPoint(this.svg,e.x,e.y)}this.zoomAtPoint(t,e,n)},u.prototype.getZoom=function(){return this.viewport.getZoom()},u.prototype.getRelativeZoom=function(){return this.viewport.getRelativeZoom()},u.prototype.computeFromRelativeZoom=function(t){return t*this.viewport.getOriginalState().zoom},u.prototype.resetZoom=function(){var t=this.viewport.getOriginalState();this.zoom(t.zoom,!0)},u.prototype.resetPan=function(){this.pan(this.viewport.getOriginalState())},u.prototype.reset=function(){this.resetZoom(),this.resetPan()},u.prototype.handleDblClick=function(t){if(this.options.preventMouseEventsDefault&&(t.preventDefault?t.preventDefault():t.returnValue=!1),this.options.controlIconsEnabled&&(t.target.getAttribute("class")||"").indexOf("svg-pan-zoom-control")>-1)return!1;var e;e=t.shiftKey?1/(2*(1+this.options.zoomScaleSensitivity)):2*(1+this.options.zoomScaleSensitivity);var n=r.getEventPoint(t,this.svg).matrixTransform(this.svg.getScreenCTM().inverse());this.zoomAtPoint(e,n)},u.prototype.handleMouseDown=function(t,e){this.options.preventMouseEventsDefault&&(t.preventDefault?t.preventDefault():t.returnValue=!1),s.mouseAndTouchNormalize(t,this.svg),this.options.dblClickZoomEnabled&&s.isDblClick(t,e)?this.handleDblClick(t):(this.state="pan",this.firstEventCTM=this.viewport.getCTM(),this.stateOrigin=r.getEventPoint(t,this.svg).matrixTransform(this.firstEventCTM.inverse()))},u.prototype.handleMouseMove=function(t){if(this.options.preventMouseEventsDefault&&(t.preventDefault?t.preventDefault():t.returnValue=!1),"pan"===this.state&&this.options.panEnabled){var e=r.getEventPoint(t,this.svg).matrixTransform(this.firstEventCTM.inverse()),n=this.firstEventCTM.translate(e.x-this.stateOrigin.x,e.y-this.stateOrigin.y);this.viewport.setCTM(n)}},u.prototype.handleMouseUp=function(t){this.options.preventMouseEventsDefault&&(t.preventDefault?t.preventDefault():t.returnValue=!1),"pan"===this.state&&(this.state="none")},u.prototype.fit=function(){var t=this.viewport.getViewBox(),e=Math.min(this.width/t.width,this.height/t.height);this.zoom(e,!0)},u.prototype.contain=function(){var t=this.viewport.getViewBox(),e=Math.max(this.width/t.width,this.height/t.height);this.zoom(e,!0)},u.prototype.center=function(){var t=this.viewport.getViewBox(),e=.5*(this.width-(t.width+2*t.x)*this.getZoom()),n=.5*(this.height-(t.height+2*t.y)*this.getZoom());this.getPublicInstance().pan({x:e,y:n})},u.prototype.updateBBox=function(){this.viewport.simpleViewBoxCache()},u.prototype.pan=function(t){var e=this.viewport.getCTM();e.e=t.x,e.f=t.y,this.viewport.setCTM(e)},u.prototype.panBy=function(t){var e=this.viewport.getCTM();e.e+=t.x,e.f+=t.y,this.viewport.setCTM(e)},u.prototype.getPan=function(){var t=this.viewport.getState();return{x:t.x,y:t.y}},u.prototype.resize=function(){var t=r.getBoundingClientRectNormalized(this.svg);this.width=t.width,this.height=t.height;var e=this.viewport;e.options.width=this.width,e.options.height=this.height,e.processCTM(),this.options.controlIconsEnabled&&(this.getPublicInstance().disableControlIcons(),this.getPublicInstance().enableControlIcons())},u.prototype.destroy=function(){var t=this;this.beforeZoom=null,this.onZoom=null,this.beforePan=null,this.onPan=null,this.onUpdatedCTM=null,null!=this.options.customEventsHandler&&this.options.customEventsHandler.destroy({svgElement:this.svg,eventsListenerElement:this.options.eventsListenerElement,instance:this.getPublicInstance()});for(var e in this.eventListeners)(this.options.eventsListenerElement||this.svg).removeEventListener(e,this.eventListeners[e],!1);this.disableMouseWheelZoom(),this.getPublicInstance().disableControlIcons(),this.reset(),c=c.filter(function(e){return e.svg!==t.svg}),delete this.options,delete this.viewport,delete this.publicInstance,delete this.pi,this.getPublicInstance=function(){return null}},u.prototype.getPublicInstance=function(){var t=this;return this.publicInstance||(this.publicInstance=this.pi={enablePan:function(){return t.options.panEnabled=!0,t.pi},disablePan:function(){return t.options.panEnabled=!1,t.pi},isPanEnabled:function(){return!!t.options.panEnabled},pan:function(e){return t.pan(e),t.pi},panBy:function(e){return t.panBy(e),t.pi},getPan:function(){return t.getPan()},setBeforePan:function(e){return t.options.beforePan=null===e?null:s.proxy(e,t.publicInstance),t.pi},setOnPan:function(e){return t.options.onPan=null===e?null:s.proxy(e,t.publicInstance),t.pi},enableZoom:function(){return t.options.zoomEnabled=!0,t.pi},disableZoom:function(){return t.options.zoomEnabled=!1,t.pi},isZoomEnabled:function(){return!!t.options.zoomEnabled},enableControlIcons:function(){return t.options.controlIconsEnabled||(t.options.controlIconsEnabled=!0,i.enable(t)),t.pi},disableControlIcons:function(){return t.options.controlIconsEnabled&&(t.options.controlIconsEnabled=!1,i.disable(t)),t.pi},isControlIconsEnabled:function(){return!!t.options.controlIconsEnabled},enableDblClickZoom:function(){return t.options.dblClickZoomEnabled=!0,t.pi},disableDblClickZoom:function(){return t.options.dblClickZoomEnabled=!1,t.pi},isDblClickZoomEnabled:function(){return!!t.options.dblClickZoomEnabled},enableMouseWheelZoom:function(){return t.enableMouseWheelZoom(),t.pi},disableMouseWheelZoom:function(){return t.disableMouseWheelZoom(),t.pi},isMouseWheelZoomEnabled:function(){return!!t.options.mouseWheelZoomEnabled},setZoomScaleSensitivity:function(e){return t.options.zoomScaleSensitivity=e,t.pi},setMinZoom:function(e){return t.options.minZoom=e,t.pi},setMaxZoom:function(e){return t.options.maxZoom=e,t.pi},setBeforeZoom:function(e){return t.options.beforeZoom=null===e?null:s.proxy(e,t.publicInstance),t.pi},setOnZoom:function(e){return t.options.onZoom=null===e?null:s.proxy(e,t.publicInstance),t.pi},zoom:function(e){return t.publicZoom(e,!0),t.pi},zoomBy:function(e){return t.publicZoom(e,!1),t.pi},zoomAtPoint:function(e,n){return t.publicZoomAtPoint(e,n,!0),t.pi},zoomAtPointBy:function(e,n){return t.publicZoomAtPoint(e,n,!1),t.pi},zoomIn:function(){return this.zoomBy(1+t.options.zoomScaleSensitivity),t.pi},zoomOut:function(){return this.zoomBy(1/(1+t.options.zoomScaleSensitivity)),t.pi},getZoom:function(){return t.getRelativeZoom()},setOnUpdatedCTM:function(e){return t.options.onUpdatedCTM=null===e?null:s.proxy(e,t.publicInstance),t.pi},resetZoom:function(){return t.resetZoom(),t.pi},resetPan:function(){return t.resetPan(),t.pi},reset:function(){return t.reset(),t.pi},fit:function(){return t.fit(),t.pi},contain:function(){return t.contain(),t.pi},center:function(){return t.center(),t.pi},updateBBox:function(){return t.updateBBox(),t.pi},resize:function(){return t.resize(),t.pi},getSizes:function(){return{width:t.width,height:t.height,realZoom:t.getZoom(),viewBox:t.viewport.getViewBox()}},destroy:function(){return t.destroy(),t.pi}}),this.publicInstance};var c=[];e.exports=function(t,e){var n=s.getSvg(t);if(null===n)return null;for(var o=c.length-1;o>=0;o--)if(c[o].svg===n)return c[o].instance.getPublicInstance();return c.push({svg:n,instance:new u(n,e)}),c[c.length-1].instance.getPublicInstance()}},{"./control-icons":2,"./shadow-viewport":3,"./svg-utilities":5,"./uniwheel":6,"./utilities":7}],5:[function(t,e,n){var o=t("./utilities"),i="unknown";document.documentMode&&(i="ie"),e.exports={svgNS:"http://www.w3.org/2000/svg",xmlNS:"http://www.w3.org/XML/1998/namespace",xmlnsNS:"http://www.w3.org/2000/xmlns/",xlinkNS:"http://www.w3.org/1999/xlink",evNS:"http://www.w3.org/2001/xml-events",getBoundingClientRectNormalized:function(t){if(t.clientWidth&&t.clientHeight)return{width:t.clientWidth,height:t.clientHeight};if(t.getBoundingClientRect())return t.getBoundingClientRect();throw new Error("Cannot get BoundingClientRect for SVG.")},getOrCreateViewport:function(t,e){var n=null;if(!(n=o.isElement(e)?e:t.querySelector(e))){var i=Array.prototype.slice.call(t.childNodes||t.children).filter(function(t){return"defs"!==t.nodeName&&"#text"!==t.nodeName});1===i.length&&"g"===i[0].nodeName&&null===i[0].getAttribute("transform")&&(n=i[0])}if(!n){var s="viewport-"+(new Date).toISOString().replace(/\D/g,"");(n=document.createElementNS(this.svgNS,"g")).setAttribute("id",s);var r=t.childNodes||t.children;if(r&&r.length>0)for(var a=r.length;a>0;a--)"defs"!==r[r.length-a].nodeName&&n.appendChild(r[r.length-a]);t.appendChild(n)}var u=[];return n.getAttribute("class")&&(u=n.getAttribute("class").split(" ")),~u.indexOf("svg-pan-zoom_viewport")||(u.push("svg-pan-zoom_viewport"),n.setAttribute("class",u.join(" "))),n},setupSvgAttributes:function(t){if(t.setAttribute("xmlns",this.svgNS),t.setAttributeNS(this.xmlnsNS,"xmlns:xlink",this.xlinkNS),t.setAttributeNS(this.xmlnsNS,"xmlns:ev",this.evNS),null!==t.parentNode){var e=t.getAttribute("style")||"";-1===e.toLowerCase().indexOf("overflow")&&t.setAttribute("style","overflow: hidden; "+e)}},internetExplorerRedisplayInterval:300,refreshDefsGlobal:o.throttle(function(){for(var t=document.querySelectorAll("defs"),e=t.length,n=0;n<e;n++){var o=t[n];o.parentNode.insertBefore(o,o)}},this.internetExplorerRedisplayInterval),setCTM:function(t,e,n){var o=this,s="matrix("+e.a+","+e.b+","+e.c+","+e.d+","+e.e+","+e.f+")";t.setAttributeNS(null,"transform",s),"transform"in t.style?t.style.transform=s:"-ms-transform"in t.style?t.style["-ms-transform"]=s:"-webkit-transform"in t.style&&(t.style["-webkit-transform"]=s),"ie"===i&&n&&(n.parentNode.insertBefore(n,n),window.setTimeout(function(){o.refreshDefsGlobal()},o.internetExplorerRedisplayInterval))},getEventPoint:function(t,e){var n=e.createSVGPoint();return o.mouseAndTouchNormalize(t,e),n.x=t.clientX,n.y=t.clientY,n},getSvgCenterPoint:function(t,e,n){return this.createSVGPoint(t,e/2,n/2)},createSVGPoint:function(t,e,n){var o=t.createSVGPoint();return o.x=e,o.y=n,o}}},{"./utilities":7}],6:[function(t,e,n){e.exports=function(){function t(t,e,n){var o=function(t){!t&&(t=window.event);var n={originalEvent:t,target:t.target||t.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==t.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){t.preventDefault?t.preventDefault():t.returnValue=!1}};return"mousewheel"==a?(n.deltaY=-.025*t.wheelDelta,t.wheelDeltaX&&(n.deltaX=-.025*t.wheelDeltaX)):n.deltaY=t.detail,e(n)};return l.push({element:t,fn:o,capture:n}),o}function e(t,e){for(var n=0;n<l.length;n++)if(l[n].element===t&&l[n].capture===e)return l[n].fn;return function(){}}function n(t,e){for(var n=0;n<l.length;n++)if(l[n].element===t&&l[n].capture===e)return l.splice(n,1)}function o(e,n,o,i){var r;r="wheel"===a?o:t(e,o,i),e[s](u+n,r,i||!1)}function i(t,o,i,s){var l;l="wheel"===a?i:e(t,s),t[r](u+o,l,s||!1),n(t,s)}var s,r,a,u="",l=[];return window.addEventListener?(s="addEventListener",r="removeEventListener"):(s="attachEvent",r="detachEvent",u="on"),a="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",{on:function(t,e,n){o(t,a,e,n),"DOMMouseScroll"==a&&o(t,"MozMousePixelScroll",e,n)},off:function(t,e,n){i(t,a,e,n),"DOMMouseScroll"==a&&i(t,"MozMousePixelScroll",e,n)}}}()},{}],7:[function(t,e,n){function o(t){return function(e){window.setTimeout(e,t)}}e.exports={extend:function(t,e){t=t||{};for(var n in e)this.isObject(e[n])?t[n]=this.extend(t[n],e[n]):t[n]=e[n];return t},isElement:function(t){return t instanceof HTMLElement||t instanceof SVGElement||t instanceof SVGSVGElement||t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName},isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isNumber:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},getSvg:function(t){var e,n;if(this.isElement(t))e=t;else{if(!("string"==typeof t||t instanceof String))throw new Error("Provided selector is not an HTML object nor String");if(!(e=document.querySelector(t)))throw new Error("Provided selector did not find any elements. Selector: "+t)}if("svg"===e.tagName.toLowerCase())n=e;else if("object"===e.tagName.toLowerCase())n=e.contentDocument.documentElement;else{if("embed"!==e.tagName.toLowerCase())throw"img"===e.tagName.toLowerCase()?new Error('Cannot script an SVG in an "img" element. Please use an "object" element or an in-line SVG.'):new Error("Cannot get SVG.");n=e.getSVGDocument().documentElement}return n},proxy:function(t,e){return function(){return t.apply(e,arguments)}},getType:function(t){return Object.prototype.toString.apply(t).replace(/^\[object\s/,"").replace(/\]$/,"")},mouseAndTouchNormalize:function(t,e){if(void 0===t.clientX||null===t.clientX)if(t.clientX=0,t.clientY=0,void 0!==t.changedTouches&&t.changedTouches.length){if(void 0!==t.changedTouches[0].clientX)t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY;else if(void 0!==t.changedTouches[0].pageX){var n=e.getBoundingClientRect();t.clientX=t.changedTouches[0].pageX-n.left,t.clientY=t.changedTouches[0].pageY-n.top}}else void 0!==t.originalEvent&&void 0!==t.originalEvent.clientX&&(t.clientX=t.originalEvent.clientX,t.clientY=t.originalEvent.clientY)},isDblClick:function(t,e){if(2===t.detail)return!0;if(void 0!==e&&null!==e){var n=t.timeStamp-e.timeStamp,o=Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2));return n<250&&o<10}return!1},now:Date.now||function(){return(new Date).getTime()},throttle:function(t,e,n){var o,i,s,r=this,a=null,u=0;n||(n={});var l=function(){u=!1===n.leading?0:r.now(),a=null,s=t.apply(o,i),a||(o=i=null)};return function(){var c=r.now();u||!1!==n.leading||(u=c);var h=e-(c-u);return o=this,i=arguments,h<=0||h>e?(clearTimeout(a),a=null,u=c,s=t.apply(o,i),a||(o=i=null)):a||!1===n.trailing||(a=setTimeout(l,h)),s}},createRequestAnimationFrame:function(t){var e=null;return"auto"!==t&&t<60&&t>1&&(e=Math.floor(1e3/t)),null===e?window.requestAnimationFrame||o(33):o(e)}}},{}],8:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=t("./nodecanvas"),i=t("./menu"),s=function(){function t(t){this.nodesCount=0;var e=this;this.canvas=new o.NodeCanvas,this.types=t,this.menu=new i.CodeNodesMenu(this),this.canvas.ondblclick=function(t,n){e.menuPoint=t,e.menu.open(n.x+20,n.y-70)},this.canvas.onclick=function(){e.menu.close()}}return t.prototype.getSVG=function(){return this.canvas.render(),this.canvas.svg},t.prototype.init=function(){this.canvas.init(),this.canvas.svg.appendChild(this.menu.g)},t.prototype.center=function(){this.canvas.center()},t.prototype.collectionTypeOf=function(t){return{id:t.id,name:t.name,description:"(Collection) "+t.description,builder:this.collectionBuilder,clone:this.collectionClone,clonable:t.clonable,outputType:t.outputType,outputMultiple:!0,schema:[{name:" - "+t,type:t.id,mode:"in",options:null,multiple:!1}]}},t.prototype.addNode=function(t,e){var n=this.types[e];if(n){var o=n.outputType||e;if(this.types[o]){var i=this.menuPoint||{x:10,y:10};this.canvas.addNode({id:this.nodesCount++,title:t,type:n,isCollection:!1,x:i.x,y:i.y})}else console.log("There is no type "+o+" registered. Can not assign output type.")}else console.log("There is no type "+e+" registered")},t.prototype.collectionBuilder=function(){function t(e){return e.reduce(function(e,n){return e.concat(Array.isArray(n)?t(n):n)},[])}return t(arguments).filter(function(t){return void 0!==t})},t.prototype.collectionClone=function(t){return t},t.prototype.addCollection=function(t,e){var n=this.types[e];if(n){var o=n.outputType||e;if(this.types[o]){var i=this.menuPoint||{x:10,y:10};this.canvas.addNode({id:this.nodesCount++,title:t,type:this.collectionTypeOf(n),isCollection:!0,x:i.x,y:i.y})}else console.log("There is no type "+o+" registered. Can not assign output type.")}else console.log("There is no type "+e+" registered")},t.prototype.serialize=function(){return{nodes:this.canvas.serialize(),transform:this.canvas.getTransform()}},t}();n.CodeNodes=s},{"./menu":9,"./nodecanvas":11}],9:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o="http://www.w3.org/2000/svg",i=function(){function t(t){function e(){c.innerHTML="",c.value="",Object.keys(n.main.types).filter(function(t){return n.main.types.hasOwnProperty(t)}).forEach(function(t){var e=document.createElement("option");e.textContent=t,e.value=t,c.appendChild(e)})}var n=this,i=null;this.main=t,this.g=document.createElementNS(o,"g"),this.g.classList.add("menu-g");var s=document.createElement("div");s.classList.add("codenodes-menu-popup"),this.popup=s;var r=document.createElement("div");r.classList.add("layer");var a=document.createElement("div");a.classList.add("content");var u=document.createElement("div");u.classList.add("wraper");var l=document.createElement("div");l.classList.add("title");var c=document.createElement("select"),h=document.createElement("div");h.classList.add("entity-selector");var p=document.createElement("input"),d=document.createElement("div");h.classList.add("entity-name");var v=document.createElement("div");v.classList.add("ok"),s.appendChild(r),s.appendChild(u),u.appendChild(a),d.appendChild(p),a.appendChild(d),h.appendChild(c),a.appendChild(h),a.appendChild(v),document.body.appendChild(s),v.addEventListener("click",function(){switch(n.close(),i){case"node":t.addNode(p.value,c.value);break;case"collection":t.addCollection(p.value,c.value)}});for(var f=0;f<4;f++)!function(r){var a=document.createElementNS(o,"rect"),u=document.createElementNS(o,"text");switch(a.classList.add("menu-rect"),u.classList.add("menu-t"),a.setAttribute("x",5..toString()),a.setAttribute("y",(35*r).toString()),u.setAttribute("x",10..toString()),u.setAttribute("y",(35*r+19).toString()),n.g.appendChild(a),n.g.appendChild(u),r){case 0:u.textContent="Add node",a.addEventListener("click",function(t){l.textContent=u.textContent,p.value="New node",p.focus(),e(),i="node",s.classList.add("visible"),t.stopPropagation()});break;case 1:u.textContent="Add collection",a.addEventListener("click",function(t){l.textContent=u.textContent,p.value="New collection",p.focus(),e(),i="collection",s.classList.add("visible"),t.stopPropagation()});break;case 2:u.textContent="Center",a.addEventListener("click",function(e){t.center(),n.close(),e.stopPropagation()});break;case 3:u.textContent="Reset"}}(f)}return t.prototype.open=function(t,e){this.g.classList.add("visible"),this.g.setAttribute("transform","translate("+t.toString()+","+e.toString()+")"),this.g.classList.add("visible")},t.prototype.close=function(){this.popup.classList.remove("visible"),this.g.classList.remove("visible")},t}();n.CodeNodesMenu=i},{}],10:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=t("./nodevalue"),i="http://www.w3.org/2000/svg",s=function(){function t(t){var e=this;this.options=t,this.values=[],this.position={x:this.options.x,y:this.options.y},this.nRows=this.options.type.schema.length+2,this.onmousedown=null,this.outputConnectors=[],this.options.type.schema.forEach(function(t){e.setValueDefaults(t);var n=t;e.options.isCollection&&(n=e.collectionValueOf(n)),e.values.push(new o.NodeValue(n,e))})}return t.prototype.setValueDefaults=function(t){t.options=t.options||[],t.multiple=t.multiple||!1},t.prototype.collectionValueOf=function(t){return{id:t.id,name:t.name+" 0",type:t.type,mode:t.mode,options:t.options,multiple:t.multiple}},t.prototype.render=function(t){var e=this;if(!this.g){this.g=document.createElementNS(i,"g"),this.g.setAttribute("transform","translate("+this.position.x+","+this.position.y+")"),this.g.setAttribute("class","entity"),this.outputOffset={x:130,y:38*this.nRows-10},this.rect=document.createElementNS(i,"rect"),this.rect.setAttribute("width",this.outputOffset.x.toString()),this.rect.setAttribute("rx","3"),this.rect.setAttribute("height",(38*this.nRows+2).toString()),this.rect.setAttribute("class","draggable"),this.rectDownHandler=function(t){this.onmousedown instanceof Function&&this.onmousedown(t,this)}.bind(this),this.rect.addEventListener("mousedown",this.rectDownHandler);var n=document.createElementNS(i,"text");n.textContent=this.options.title,n.classList.add("title"),n.setAttribute("x","5"),n.setAttribute("y","15"),this.g.appendChild(this.rect),this.g.appendChild(n);var o=document.createElementNS(i,"circle");this.output=o,o.setAttribute("cx",this.outputOffset.x.toString()),o.setAttribute("cy",this.outputOffset.y.toString()),o.setAttribute("r","6"),o.setAttribute("class","output"),this.outputDownHandler=function(t){this.outputMousedown instanceof Function&&this.outputMousedown(t,this)}.bind(this),o.addEventListener("mousedown",this.outputDownHandler);var s=document.createElementNS(i,"text");this.outputText=s,this.options.type.outputMultiple?s.textContent="["+this.options.type.outputType+"]":s.textContent=this.options.type.outputType,s.classList.add("output-type"),s.setAttribute("x",(this.outputOffset.x-10).toString()),s.setAttribute("y",this.outputOffset.y.toString()),this.g.appendChild(o),this.g.appendChild(s),this.closeBtn=document.createElementNS(i,"circle"),this.closeBtn.classList.add("close-btn"),this.closeBtn.setAttribute("cx",(this.outputOffset.x-10).toString()),this.closeBtn.setAttribute("r","6"),this.closeBtn.setAttribute("cy","15"),this.close=function(){this.remove()}.bind(this),this.closeBtn.addEventListener("click",this.close),this.g.appendChild(this.closeBtn),t.appendChild(this.g)}var r=1;this.values.forEach(function(t){t.render(e.g,r++)})},t.prototype.cloneLastValue=function(){var t=this;if(this.options.isCollection){var e=this.options.type.schema;if(t.values.every(function(t){return null!==t.inputConnector})){var n=JSON.parse(JSON.stringify(e[e.length-1]));n.name,e.length;e.push(n),this.nRows++;var i=new o.NodeValue(n,t);t.values.push(i),i.render(t.g,e.length),this.outputOffset.y=38*this.nRows-10,this.output.setAttribute("cx",this.outputOffset.x.toString()),this.output.setAttribute("cy",this.outputOffset.y.toString()),this.outputText.setAttribute("y",this.outputOffset.y.toString()),this.rect.setAttribute("height",(38*this.nRows+2).toString())}}},t.prototype.move=function(t,e){var n=this;this.position={x:t,y:e},this.outputConnectors.forEach(function(o){o.sp={x:t+n.outputOffset.x,y:e+n.outputOffset.y},o.setPath()}),this.values.forEach(function(t){t.updateConectorPosition()}),this.g.setAttribute("transform","translate("+this.position.x+","+this.position.y+")")},t.prototype.serialize=function(){return{arguments:JSON.parse(JSON.stringify(this.options)),values:this.values.map(function(t){return{valueID:t.options.id,value:t.__internalGetValue()}}),outputConnectors:this.outputConnectors.map(function(t){return{nodeTo:t.end2.parentNode.options.id,valueTo:t.end2.options.id}})}},t.prototype.findValue=function(t){var e,n=this.values.length;for(e=0;e<n;e+=1)if(this.values[e].options.id===t)return this.values[e];return null},t.prototype.setValues=function(t){var e=this;this.options.isCollection||t.forEach(function(t){var n=e.values.filter(function(e){return e.options.id===t.valueID})[0];n.__internalSetValue instanceof Function&&n.__internalSetValue(t.value)})},t.prototype.build=function(){if(this.built)return this.options.type.clonable?this.options.type.clone(this.built):this.built;this.options.type.schema;var t=[];return t=this.values.map(function(t){return t.getValue()}),this.built=this.options.type.builder.apply(this,t),this.built},t.prototype.remove=function(){this.values.forEach(function(t){t.inputConnector&&t.inputConnector.remove()}),[].concat(this.outputConnectors).forEach(function(t){t.remove()}),this.onremove instanceof Function&&this.onremove(),this.closeBtn.removeEventListener("click",this.close),this.rect.removeEventListener("mousedown",this.rectDownHandler),this.output.addEventListener("mousedown",this.outputDownHandler)},t}();n.Node=s},{"./nodevalue":13}],11:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=t("svg-pan-zoom"),i=t("./node"),s=t("./nodeconnector"),r="http://www.w3.org/2000/svg",a=function(){function t(){this.svg=null,this.g=null,this.paths=null,this.nodes=[],this.pt=null,this.draggingEntity=null,this.currentConnector=null,this.diff=null}return t.prototype.center=function(){this.zoomingSvg.reset()},t.prototype.cursorPoint=function(t){return this.pt.x=t.clientX,this.pt.y=t.clientY,this.pt.matrixTransform(this.svg.getScreenCTM().inverse())},t.prototype.render=function(){var t=this;this.svg||(this.svg=document.createElementNS(r,"svg"),this.svg.setAttribute("class","codenodes"),this.pt=this.svg.createSVGPoint(),this.svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns",r),this.svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%"),this.g=document.createElementNS(r,"g"),this.paths=document.createElementNS(r,"g"),this.g.classList.add("svg-pan-zoom_viewport"),this.g.setAttribute("transform","matrix(1,1,1,1,0,0)"),this.g.appendChild(this.paths),this.svg.appendChild(this.g),this.svg.addEventListener("dblclick",function(e){if(e.target instanceof SVGSVGElement){var n=t.cursorPoint(e);t.ctm=t.g.getCTM().inverse(),t.offset=t.svg.getBoundingClientRect(),t.ondblclick(t.convertCoords(n),n)}}),this.svg.addEventListener("click",function(e){t.onclick()}))},t.prototype.getTransform=function(){return this.g.getAttribute("transform")},t.prototype.setTransform=function(t){this.g.setAttribute("transform",t)},t.prototype.convertCoords=function(t){var e=t.x,n=t.y;return{x:this.ctm.a*e+this.ctm.c*n+this.ctm.e,y:this.ctm.b*e+this.ctm.d*n+this.ctm.f}},t.prototype.addNode=function(t){function e(t){if(u.draggingEntity){var e=u.cursorPoint(t);e.x=e.x-u.diff.x,e.y=e.y-u.diff.y;var n=u.convertCoords(e);u.draggingEntity.move(n.x,n.y)}}function n(t){u.svg.removeEventListener("mousemove",e),u.svg.removeEventListener("mouseup",n),e(t),u.draggingEntity=null}function o(t){var e=u.convertCoords(u.cursorPoint(t));u.currentConnector.moveEndPoint(e)}function r(t){var e=u.convertCoords(u.cursorPoint(t));u.svg.removeEventListener("mousemove",o),u.svg.removeEventListener("mouseup",r);var n=[].slice.call(document.querySelectorAll(".codenodes .dot")),i=u.currentConnector,s=n.map(function(t){var n=t.parentValue.getDotPosition();return{dist:Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),dot:t}}).filter(function(t){return t.dist<=30}).sort(function(t,e){return t.dist-e.dist});if(s.length>0){var a=s[0].dot;if(a.parentValue.inputConnector&&a.parentValue.inputConnector.remove(),a.parentValue.inputConnector=i,i.end2=a.parentValue,i.end1===a.parentValue.parentNode)return void i.remove();if("any"!==i.end2.options.type&&i.end2.options.type!==i.end1.options.type.outputType)return void i.remove();i.end2.parentNode.options.isCollection&&i.end2.parentNode.cloneLastValue(),a.parentValue.updateConectorPosition()}else i.remove();u.currentConnector=null}var a=new i.Node(t),u=this;return this.nodes.push(a),a.outputMousedown=function(t,e){u.cursorPoint(t);u.ctm=u.g.getCTM().inverse(),u.offset=u.svg.getBoundingClientRect();var n={x:e.position.x+parseInt(e.output.getAttribute("cx")),y:e.position.y+parseInt(e.output.getAttribute("cy"))};u.currentConnector=new s.NodeConnector(n,e),e.outputConnectors.push(u.currentConnector),u.paths.appendChild(u.currentConnector.path),u.svg.addEventListener("mousemove",o),u.svg.addEventListener("mouseup",r),t.stopPropagation()},a.onmousedown=function(t,o){var i=u.cursorPoint(t);u.ctm=u.g.getCTM(),u.offset=u.svg.getBoundingClientRect();var s=u.convertCoords(o.position);u.diff={x:i.x-s.x,y:i.y-s.y},u.ctm=u.ctm.inverse(),t.stopPropagation(),u.draggingEntity=o,u.draggingEntity&&(u.svg.addEventListener("mousemove",e),u.svg.addEventListener("mouseup",n))}.bind(this),a.onremove=function(){a.outputMousedown=null,a.onmousedown=null;var t=u.nodes.indexOf(a);t>=0&&u.nodes.splice(t,1),u.g.removeChild(a.g)},a.render(u.g),a},t.prototype.init=function(){this.svg.setAttribute("viewBox","0 0 "+this.svg.clientWidth+" "+this.svg.clientHeight),this.zoomingSvg=o(this.svg,{zoomScaleSensitivity:.4,dblClickZoomEnabled:!1})},t.prototype.serialize=function(){return this.nodes.map(function(t){return t.serialize()})},t.prototype.findNode=function(t){var e,n=this.nodes.length;for(e=0;e<n;e+=1)if(this.nodes[e].options.id===t)return this.nodes[e];return null},t.prototype.parse=function(t){var e=this;t.forEach(function(t){e.addNode(t.arguments).setValues(t.values)}),t.forEach(function(t){e.findNode(t.arguments.id);t.outputConnectors.forEach(function(t){var n=e.findNode(t.nodeTo);n.options.isCollection&&n.cloneLastValue(),n.findValue(t.valueTo).inputConnector})})},t.prototype.clear=function(){[].concat(this.nodes).forEach(function(t){t.remove()})},t.prototype.getTerminalNodes=function(){return this.nodes.filter(function(t){return 0===t.outputConnectors.length})},t}();n.NodeCanvas=a},{"./node":10,"./nodeconnector":12,"svg-pan-zoom":1}],12:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o="http://www.w3.org/2000/svg",i=function(){function t(t,e){this.sp=t,this.ep=t,this.end1=e,this.end2=null,this.path=document.createElementNS(o,"path"),this.setPath()}return t.prototype.setPath=function(){var t={x:(this.ep.x-this.sp.x)/3+this.sp.x,y:this.sp.y},e={x:-(this.ep.x-this.sp.x)/3+this.ep.x,y:this.ep.y};this.path.setAttribute("d","M"+this.sp.x+","+this.sp.y+" C"+t.x+","+t.y+" "+e.x+","+e.y+" "+this.ep.x+","+this.ep.y)},t.prototype.remove=function(){if(this.end1){var t=this.end1.outputConnectors.indexOf(this);t>=0&&this.end1.outputConnectors.splice(t,1),this.end1=null}this.end2&&(this.end2.inputConnector=null),this.path&&(this.path.parentNode.removeChild(this.path),this.path=null)},t.prototype.moveEndPoint=function(t){this.ep=t,this.setPath()},t}();n.NodeConnector=i},{}],13:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o="http://www.w3.org/2000/svg",i=function(){function t(t,e){this.options=t,this.inputConnector=null,this.__internalGetValue=null,this.svgEntity=null,this.gOffset=null,this.parentNode=e}return t.prototype.render=function(t,e){var n=this;if(!this.svgEntity){var i=document.createElementNS(o,"g");if(this.gOffset={x:1,y:38*e+1},i.setAttribute("transform","translate("+this.gOffset.x+", "+this.gOffset.y+")"),i.setAttribute("class","row"),"edit"===this.options.mode){var s=document.createElementNS(o,"rect"),r=document.createElementNS(o,"foreignObject"),a=document.createElementNS(o,"text"),u=document.createElementNS("http://www.w3.org/1999/xhtml","div");a.textContent=this.options.name,a.setAttribute("x","10"),a.setAttribute("y","6"),s.setAttribute("x","1"),u.setAttribute("xmlns","http://www.w3.org/1999/xhtml");var l=document.createElement("input");switch(this.options.type){case"range":l.min=this.options[0],l.max=this.options[1];case"text":case"number":case"email":case"date":case"color":this.__internalGetValue=function(){return l.value},this.__internalSetValue=function(t){l.value=t},l.type=this.options.type,u.appendChild(l);break;case"boolean":this.__internalGetValue=function(){return l.checked},this.__internalSetValue=function(t){l.checked=t},l.type="checkbox",u.appendChild(l);break;case"select":var c=document.createElement("select");this.options.options.forEach(function(t){var e=document.createElement("option");e.textContent=t.show.toString(),e.setAttribute("value",t.save),c.appendChild(e)}),this.__internalGetValue=function(){return c.value},this.__internalSetValue=function(t){l.value=t},u.appendChild(c);break;case"popup":var h=document.createElement("button");h.classList.add("popup-btn"),h.textContent="*Edit";var p=document.createElement("div");p.classList.add("codenodes-popup");var d=document.createElement("div");d.classList.add("layer");var v=document.createElement("div");v.classList.add("content");var f=document.createElement("div");f.classList.add("wraper");var m=document.createElement("div");m.classList.add("text"),m.setAttribute("contenteditable","true");var g=document.createElement("div");g.classList.add("ok"),h.addEventListener("click",function(){p.classList.add("visible")});p.appendChild(d),p.appendChild(f),f.appendChild(v),v.appendChild(m),v.appendChild(g),g.addEventListener("click",function(){p.classList.remove("visible")}),this.__internalGetValue=function(){return m.textContent},this.__internalSetValue=function(t){m.textContent=t},document.body.appendChild(p),u.appendChild(h)}r.appendChild(u),r.setAttribute("transform","translate(0,13)"),i.appendChild(a),i.appendChild(r)}if("in"===this.options.mode){var y=document.createElementNS(o,"text"),b=document.createElementNS(o,"text"),w=document.createElementNS(o,"circle");w.setAttribute("cx","-1"),w.setAttribute("cy","16"),w.setAttribute("r","4"),w.setAttribute("class","dot"),w.addEventListener("click",function(t){n.inputConnector&&n.inputConnector.remove(),t.stopPropagation()}),w.parentValue=this,y.textContent=this.options.name,y.setAttribute("x","10"),y.setAttribute("y","8"),this.options.multiple?b.textContent="["+this.options.type+"]":b.textContent=this.options.type,b.classList.add("value-type"),b.setAttribute("x","10"),b.setAttribute("y","25"),this.__internalGetValue=function(){if(n.inputConnector){var t=n.inputConnector.end1.build();return n.options.multiple&&!n.inputConnector.end1.options.type.outputMultiple?[t]:t}},i.appendChild(y),i.appendChild(b),i.appendChild(w)}this.svgEntity=i,t.appendChild(i)}},t.prototype.getSerializedValue=function(){return"edit"===this.options.mode&&this.__internalGetValue instanceof Function?this.__internalGetValue():null},t.prototype.getDotPosition=function(){return{x:this.parentNode.position.x+this.gOffset.x-1,y:this.parentNode.position.y+this.gOffset.y+16}},t.prototype.updateConectorPosition=function(){this.inputConnector&&(this.inputConnector.ep=this.getDotPosition(),this.inputConnector.setPath())},t.prototype.getValue=function(){return this.__internalGetValue instanceof Function?this.__internalGetValue():null},t}();n.NodeValue=i},{}]},{},[8])(8)});
//# sourceMappingURL=codenodes.min.js.map
