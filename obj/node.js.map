{"version":3,"sources":["node.ts"],"names":[],"mappings":"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","file":"node.js","sourcesContent":["import {NodeValue} from \"./nodevalue\";\r\nimport {NodeConnector} from \"./nodeconnector\";\r\nimport {Point} from \"./point\";\r\nimport {ICodeNodesValueSchema} from \"./interfaces/ICodeNodesValueSchema\";\r\nimport {INodeArguments} from \"./interfaces/INodeArguments\";\r\nimport {INodeModel} from \"./interfaces/INodeModel\";\r\n\r\n\r\nconst namespace = \"http://www.w3.org/2000/svg\";\r\nconst ROW_HEIGHT = 38;\r\n\r\n\r\ndeclare type NodeValueModel = {valueID:number, value: any};\r\ndeclare type NodeConnectorModel = {valueID:number, nodeID: number};\r\n\r\nexport class Node {\r\n\r\n    private rect: SVGRectElement;\r\n    public g: SVGGElement;\r\n    private output: SVGCircleElement;\r\n    private closeBtn: SVGCircleElement;\r\n    private built: any;\r\n    public outputOffset: Point;\r\n    private outputText: SVGTextElement;\r\n    private values: NodeValue[];\r\n    public position: Point;\r\n    public options: INodeArguments;\r\n    private nRows: number;\r\n    public onmousedown: Function;\r\n    public outputMousedown: Function;\r\n    public rectDownHandler: EventListenerOrEventListenerObject;\r\n    public outputConnectors: Array<NodeConnector>;\r\n    public outputDownHandler: EventListenerOrEventListenerObject;\r\n    private close: EventListenerOrEventListenerObject;\r\n    public onremove: Function;\r\n\r\n\r\n    constructor(opts: INodeArguments) {\r\n        let self = this;\r\n        this.options = opts;\r\n        this.values = [];\r\n        this.position = {\r\n            x: this.options.x,\r\n            y: this.options.y\r\n        };\r\n        this.nRows = this.options.type.schema.length + 2;\r\n        this.onmousedown = null;\r\n        this.outputConnectors = [];\r\n        this.options.type.schema.forEach(function(prop) {\r\n            self.setValueDefaults(prop)\r\n            let p = prop;\r\n            if (self.options.isCollection) {\r\n                p = self.collectionValueOf(p);\r\n            }\r\n            self.values.push(new NodeValue(p, self));\r\n        });\r\n    };\r\n\r\n    private setValueDefaults(v: ICodeNodesValueSchema) {\r\n        v.options = v.options || [];\r\n        v.multiple = v.multiple || false;\r\n        v.mode = v.mode || \"edit\";\r\n    }\r\n\r\n    private collectionValueOf(v: ICodeNodesValueSchema): ICodeNodesValueSchema{\r\n        return {\r\n            id: v.id,\r\n            name: v.name + \" 0\",\r\n            type: v.type,\r\n            mode: v.mode,\r\n            options: v.options,\r\n            multiple: v.multiple\r\n        };\r\n    }\r\n\r\n    render(parent: SVGElement) {\r\n        let self = this;\r\n        if (!this.g) {\r\n            this.g = document.createElementNS(namespace, \"g\");\r\n            this.g.setAttribute(\"transform\", \"translate(\" + this.position.x + \",\" + this.position.y + \")\");\r\n            this.g.setAttribute(\"class\", \"entity\");\r\n\r\n            this.outputOffset = {\r\n                x: 130,\r\n                y: (this.nRows * ROW_HEIGHT) - 10\r\n            };\r\n\r\n            this.rect = document.createElementNS(namespace, \"rect\");\r\n            this.rect.setAttribute(\"width\", this.outputOffset.x.toString());\r\n            this.rect.setAttribute(\"rx\", \"3\");\r\n            this.rect.setAttribute(\"height\", ((this.nRows * ROW_HEIGHT) + 2).toString());\r\n            this.rect.setAttribute(\"class\", \"draggable\");\r\n            this.rectDownHandler = function(evt) {\r\n                if (this.onmousedown instanceof Function) {\r\n                    this.onmousedown(evt, this);\r\n                }\r\n            }.bind(this);\r\n            this.rect.addEventListener(\"mousedown\", this.rectDownHandler);\r\n\r\n\r\n            let t = document.createElementNS(namespace, \"text\");\r\n            t.textContent = this.options.title;\r\n            t.classList.add(\"title\");\r\n            t.setAttribute(\"x\", \"5\");\r\n            t.setAttribute(\"y\", \"15\");\r\n\r\n            this.g.appendChild(this.rect);\r\n            this.g.appendChild(t);\r\n\r\n            let output = document.createElementNS(namespace, \"circle\");\r\n            this.output = output;\r\n            output.setAttribute(\"cx\", (this.outputOffset.x).toString());\r\n            output.setAttribute(\"cy\", (this.outputOffset.y).toString());\r\n            output.setAttribute(\"r\", \"6\");\r\n            output.setAttribute(\"class\", \"output\");\r\n            this.outputDownHandler = function(evt) {\r\n                if (this.outputMousedown instanceof Function) {\r\n                    this.outputMousedown(evt, this);\r\n                }\r\n            }.bind(this);\r\n            output.addEventListener(\"mousedown\", this.outputDownHandler);\r\n            let outputType = document.createElementNS(namespace, \"text\");\r\n            this.outputText = outputType;\r\n            if (this.options.type.outputMultiple) {  \r\n                outputType.textContent = \"[\" + this.options.type.outputType + \"]\";\r\n            } else {\r\n                outputType.textContent = this.options.type.outputType;\r\n            }\r\n            outputType.classList.add(\"output-type\");\r\n            outputType.setAttribute(\"x\", (this.outputOffset.x - 10).toString());\r\n            outputType.setAttribute(\"y\", (this.outputOffset.y).toString());\r\n            this.g.appendChild(output);\r\n            this.g.appendChild(outputType);\r\n\r\n\r\n            this.closeBtn = document.createElementNS(namespace, \"circle\");\r\n            this.closeBtn.classList.add(\"close-btn\");\r\n            this.closeBtn.setAttribute(\"cx\", (this.outputOffset.x - 10).toString());\r\n            this.closeBtn.setAttribute(\"r\", \"6\");\r\n            this.closeBtn.setAttribute(\"cy\", \"15\");\r\n        \tthis.close = function() {\r\n\t\t\t\tthis.remove();\r\n            }.bind(this);\r\n            this.closeBtn.addEventListener(\"click\", this.close);\r\n            this.g.appendChild(this.closeBtn);\r\n\r\n            parent.appendChild(this.g);\r\n        }\r\n        let i = 1;\r\n\r\n        this.values.forEach(function(val) {\r\n            val.render(self.g, i++);\r\n        });\r\n    };\r\n    cloneLastValue () {\r\n        let self = this;\r\n        if (this.options.isCollection) {\r\n            let schema = this.options.type.schema,\r\n            full = self.values.every(val => {\r\n                return val.inputConnector !== null;\r\n            });\r\n            if (full) {\r\n                let prop = JSON.parse(JSON.stringify(schema[schema.length - 1])),\r\n                    name = prop.name + \" \" + schema.length;\r\n                schema.push(prop);\r\n                this.nRows++;\r\n                let newN = new NodeValue(prop, self)\r\n                self.values.push(newN);\r\n                newN.render(self.g, schema.length);\r\n                this.outputOffset.y = (this.nRows * ROW_HEIGHT) - 10;\r\n                \r\n                this.output.setAttribute(\"cx\", (this.outputOffset.x).toString());\r\n                this.output.setAttribute(\"cy\", (this.outputOffset.y).toString());\r\n                this.outputText.setAttribute(\"y\", (this.outputOffset.y).toString());\r\n                this.rect.setAttribute(\"height\", ((this.nRows * ROW_HEIGHT) + 2).toString());\r\n            }\r\n        }\r\n    };\r\n    move(x, y) {\r\n        let self = this;\r\n        this.position = {\r\n            x: x,\r\n            y: y\r\n        };\r\n        this.outputConnectors.forEach(function(con) {\r\n            con.sp = {\r\n                x: x + self.outputOffset.x,\r\n                y: y + self.outputOffset.y\r\n            };\r\n            con.setPath();\r\n        });\r\n\r\n        this.values.forEach(function(val) {\r\n            val.updateConectorPosition();\r\n        });\r\n        this.g.setAttribute(\"transform\", \"translate(\" + this.position.x + \",\" + this.position.y + \")\");\r\n    };\r\n\r\n    serialize (): INodeModel {\r\n        let self = this,\r\n            model = <INodeModel> {\r\n            arguments: JSON.parse(JSON.stringify(this.options)),\r\n            values: this.values.map(v => {\r\n                return {\r\n                    valueID: v.options.id,\r\n                    value: v.__internalGetValue(true)\r\n                };\r\n            }),\r\n            outputConnectors: this.outputConnectors.map(c => {\r\n                return {\r\n                    nodeTo: c.end2.parentNode.options.id,\r\n                    valueTo: c.end2.options.id\r\n                };\r\n            })\r\n        };\r\n        model.arguments.x = this.position.x;\r\n        model.arguments.y = this.position.y;\r\n        return model;\r\n    };\r\n\r\n    findValue (id: number): NodeValue {\r\n        let i, len = this.values.length;\r\n        for (i = 0; i < len; i += 1) {\r\n            if (this.values[i].options.id === id) return this.values[i];\r\n        }\r\n        return null;\r\n    }\r\n\r\n    setValues (vs: NodeValueModel[]) {\r\n        let self = this;\r\n        if (!this.options.isCollection) {\r\n            vs.forEach(v => {\r\n                let value = self.values.filter(val => {\r\n                    return val.options.id === v.valueID;\r\n                })[0];\r\n                if (value.__internalSetValue instanceof Function) {\r\n                    value.__internalSetValue(v.value);\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    build() {\r\n        if (!this.built) {\r\n\t\t\tvar schema = this.options.type.schema,\r\n                valuesArr = [],\r\n\t\t\t\tself = this;\r\n\t\t\tvaluesArr = this.values.map(function(v) {\r\n\t\t\t\treturn v.getValue();\r\n\t\t\t});\r\n\t\t\tthis.built =  this.options.type.builder.apply(this, valuesArr);\r\n\t\t\treturn this.built;\r\n\t\t} else {\r\n\t\t\tif (this.options.type.clonable) {\r\n\t\t\t\treturn this.options.type.clone(this.built);\r\n\t\t\t} else {\r\n\t\t\t\treturn this.built;\r\n\t\t\t}\r\n\t\t}\r\n    };\r\n\r\n    remove() {\r\n        let self = this;\r\n        this.values.forEach(function(val) {\r\n            val.remove();\r\n        });\r\n        this.values = null;\r\n        [].concat(this.outputConnectors).forEach(function(con: NodeConnector) {\r\n            con.remove();\r\n        });\r\n\t\tif (this.onremove instanceof Function) {\r\n\t\t\tthis.onremove();\r\n\t\t}\r\n        this.closeBtn.removeEventListener(\"click\", this.close);\r\n        this.rect.removeEventListener(\"mousedown\", this.rectDownHandler);\r\n        this.output.addEventListener(\"mousedown\", this.outputDownHandler);\r\n    };\r\n}"]}