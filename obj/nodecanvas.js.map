{"version":3,"sources":["nodecanvas.ts"],"names":[],"mappings":"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","file":"nodecanvas.js","sourcesContent":["import * as svgPanZoom from \"svg-pan-zoom\";\r\nimport {Point} from \"./point\";\r\nimport {Node} from \"./node\";\r\nimport {NodeConnector} from \"./nodeconnector\";\r\nimport {INodeArguments} from \"./interfaces/INodeArguments\";\r\nimport {INodeModel} from \"./interfaces/INodeModel\";\r\n\r\nconst namespace = \"http://www.w3.org/2000/svg\";\r\n\r\n\r\nexport class NodeCanvas {\r\n\r\n    private pt: SVGPoint;\r\n    public svg: SVGSVGElement;\r\n    private nodes: Array<Node>;\r\n    private currentConnector: NodeConnector;\r\n    private g: SVGGElement;\r\n    private paths: SVGGElement;\r\n    private draggingEntity: Node;\r\n    private diff: Point;\r\n    public zoomingSvg: SvgPanZoom.Instance;\r\n    public ondblclick: Function;\r\n    public onclick: Function;\r\n    private offset: ClientRect;\r\n    private ctm: SVGMatrix;\r\n\r\n    constructor () {\r\n        this.svg = null;\r\n        this.g = null;\r\n        this.paths = null;\r\n        this.nodes = [];\r\n        this.pt = null;\r\n        this.draggingEntity = null;\r\n        this.currentConnector = null;\r\n        this.diff = null;\r\n    }\r\n\r\n    center () {\r\n        this.zoomingSvg.reset();\r\n    }\r\n\r\n    cursorPoint(evt) {\r\n        this.pt.x = evt.clientX;\r\n        this.pt.y = evt.clientY;\r\n        return this.pt.matrixTransform(this.svg.getScreenCTM().inverse());\r\n    };\r\n\r\n    render() {\r\n        let self = this;\r\n        if (!this.svg) {\r\n            this.svg = document.createElementNS(namespace, \"svg\");\r\n            this.svg.setAttribute(\"class\", \"codenodes\");\r\n            this.pt = this.svg.createSVGPoint();\r\n            this.svg.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns\", namespace);\r\n            this.svg.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\r\n            this.svg.setAttribute(\"width\", \"100%\");\r\n            this.svg.setAttribute(\"height\", \"100%\");\r\n            this.g = document.createElementNS(namespace, \"g\");\r\n            this.paths = document.createElementNS(namespace, \"g\");\r\n            this.g.classList.add(\"svg-pan-zoom_viewport\");\r\n            this.g.setAttribute(\"transform\", \"matrix(1,1,1,1,0,0)\");\r\n            this.g.appendChild(this.paths);\r\n            this.svg.appendChild(this.g);\r\n            this.svg.addEventListener(\"dblclick\", function (evt) {\r\n                if (!(evt.target instanceof SVGSVGElement)) return;\r\n                let p = self.cursorPoint(evt);\r\n                self.ctm = self.g.getCTM().inverse();\r\n                self.offset = self.svg.getBoundingClientRect();\r\n                self.ondblclick(self.convertCoords(p), p);\r\n            });\r\n            this.svg.addEventListener(\"click\", function (evt) {\r\n                self.onclick();\r\n            });\r\n        };\r\n    };\r\n    getTransform() {\r\n        let ctm = this.g.getCTM();\r\n        return {\r\n            pan: {x: ctm.e, y: ctm.f},\r\n            zoom: ctm.a\r\n        };\r\n    };\r\n    setTransform(transform: {pan:{x: number, y: number}, zoom: number}) {\r\n        this.zoomingSvg.zoom(transform.zoom);\r\n        this.zoomingSvg.pan(transform.pan);\r\n    }\r\n    convertCoords(o: Point) {\r\n        var x = o.x,\r\n            y = o.y;\r\n        return {\r\n            x: (this.ctm.a * x) + (this.ctm.c * y) + this.ctm.e ,//- this.offset.left,\r\n            y: (this.ctm.b * x) + (this.ctm.d * y) + this.ctm.f //- this.offset.top\r\n        };\r\n    }\r\n    addNode (opts: INodeArguments): Node {\r\n        var n = new Node(opts),\r\n            self = this;\r\n        function mouseMoveHandler(evt) {\r\n            if (self.draggingEntity) {\r\n                var p = self.cursorPoint(evt);\r\n                p.x = p.x - self.diff.x;\r\n                p.y = p.y - self.diff.y;\r\n                let p1 = self.convertCoords(p);\r\n                self.draggingEntity.move(p1.x, p1.y);\r\n            }\r\n        }\r\n\r\n        function mouseUpHandler(evt) {\r\n            self.svg.removeEventListener(\"mousemove\", mouseMoveHandler);\r\n            self.svg.removeEventListener(\"mouseup\", mouseUpHandler);\r\n            mouseMoveHandler(evt);\r\n            self.draggingEntity = null;\r\n        }\r\n\r\n        function mouseMoveConnectorHandler(evt) {\r\n            var p = self.convertCoords(self.cursorPoint(evt));\r\n            self.currentConnector.moveEndPoint(p);\r\n        }\r\n\r\n        function mouseUpConnectorHandler(evt) {\r\n            let p = self.convertCoords(self.cursorPoint(evt));\r\n            self.svg.removeEventListener(\"mousemove\", mouseMoveConnectorHandler);\r\n            self.svg.removeEventListener(\"mouseup\", mouseUpConnectorHandler);\r\n            let dots = [].slice.call(document.querySelectorAll(\".codenodes .dot\"));\r\n            let cc: NodeConnector = self.currentConnector;\r\n            let candidates = dots.map(function(dot) {\r\n                let pos = dot.parentValue.getDotPosition();\r\n                let dist = Math.sqrt(Math.pow(p.x - pos.x, 2) + Math.pow(p.y - pos.y, 2));\r\n                return {\r\n                    dist: dist,\r\n                    dot: dot\r\n                };\r\n            }).filter(function(dot) {\r\n                return dot.dist <= 30;\r\n            }).sort(function(a, b) {\r\n                return a.dist - b.dist;\r\n            });\r\n            if (candidates.length > 0) {\r\n                let candidateDot = candidates[0].dot;\r\n                if (cc.end1 === candidateDot.parentValue.parentNode) {\r\n                    cc.remove();\r\n                    return;\r\n                }\r\n                if (candidateDot.parentValue.options.type !== \"any\" && (candidateDot.parentValue.options.type !== cc.end1.options.type.outputType ||\r\n                    (!candidateDot.parentValue.options.multiple && cc.end1.options.type.outputMultiple)\r\n                )) {\r\n                    cc.remove();\r\n                    return;\r\n                }\r\n                if (candidateDot.parentValue.inputConnector) {\r\n                    candidateDot.parentValue.inputConnector.remove();\r\n                }\r\n                candidateDot.parentValue.inputConnector = cc;\r\n                cc.end2 = candidateDot.parentValue;\r\n                if (cc.end2.parentNode.options.isCollection) {\r\n                    cc.end2.parentNode.cloneLastValue();\r\n                }\r\n                candidateDot.parentValue.updateConectorPosition();\r\n            } else {\r\n                cc.remove();\r\n            }\r\n            self.currentConnector = null;\r\n        }\r\n\r\n        this.nodes.push(n);\r\n        n.outputMousedown = function(evt, entity: Node) {\r\n            let p = self.cursorPoint(evt);\r\n            self.ctm = self.g.getCTM().inverse();\r\n            self.offset = self.svg.getBoundingClientRect();\r\n            let p1 = {\r\n                x: entity.position.x + parseInt(entity.outputOffset.x.toString()),\r\n                y: entity.position.y + parseInt(entity.outputOffset.y.toString())\r\n            }\r\n            self.currentConnector = new NodeConnector(p1, entity);\r\n            entity.outputConnectors.push(self.currentConnector);\r\n            self.paths.appendChild(self.currentConnector.path);\r\n            self.svg.addEventListener(\"mousemove\", mouseMoveConnectorHandler);\r\n            self.svg.addEventListener(\"mouseup\", mouseUpConnectorHandler);\r\n            evt.stopPropagation();\r\n        };\r\n        n.onmousedown = function(evt, entity) {\r\n            let p = self.cursorPoint(evt);\r\n            self.ctm = self.g.getCTM();\r\n            self.offset = self.svg.getBoundingClientRect();\r\n            var entPos = self.convertCoords(entity.position);\r\n            self.diff = {\r\n                x: p.x - entPos.x,\r\n                y: p.y - entPos.y\r\n            };\r\n            self.ctm = self.ctm.inverse();\r\n            evt.stopPropagation();\r\n            self.draggingEntity = entity;\r\n            if (self.draggingEntity) {\r\n                self.svg.addEventListener(\"mousemove\", mouseMoveHandler);\r\n                self.svg.addEventListener(\"mouseup\", mouseUpHandler);\r\n            }\r\n        }.bind(this);\r\n        n.onremove = function() {\r\n            n.outputMousedown = null;\r\n            n.onmousedown = null;\r\n            var ind = self.nodes.indexOf(n);\r\n            if (ind >= 0) {\r\n                self.nodes.splice(ind, 1);\r\n            }\r\n            self.g.removeChild(n.g);\r\n        }\r\n        n.render(self.g);\r\n        return n;\r\n    };\r\n\r\n    init () {\r\n        this.svg.setAttribute(\"viewBox\", \"0 0 \" + this.svg.clientWidth + \" \" + this.svg.clientHeight);\r\n        this.zoomingSvg = svgPanZoom(this.svg, {\r\n            zoomScaleSensitivity: 0.4,\r\n            dblClickZoomEnabled: false\r\n        });\r\n    };\r\n\r\n    serialize (): INodeModel[] {\r\n        return this.nodes.map(n => {\r\n            return n.serialize();\r\n        });\r\n    }\r\n\r\n    findNode (id: number): Node {\r\n        let i, len = this.nodes.length;\r\n        for (i = 0; i < len; i += 1) {\r\n            if (this.nodes[i].options.id === id) return this.nodes[i];\r\n        }\r\n        return null;\r\n    }\r\n\r\n    parse (nodes: INodeModel[]) {\r\n        let self = this;\r\n        nodes.forEach(nm => {\r\n            let n = self.addNode(nm.arguments);\r\n            n.setValues(nm.values);\r\n        });\r\n\r\n        nodes.forEach(nm => {\r\n            let n = self.findNode(nm.arguments.id);\r\n            nm.outputConnectors.forEach(cn => {\r\n                let end2 = self.findNode(cn.nodeTo);\r\n                let p1 = {\r\n                    x: n.position.x + parseInt(n.outputOffset.x.toString()),\r\n                    y: n.position.y + parseInt(n.outputOffset.y.toString())\r\n                }\r\n                let conn = new NodeConnector(p1, n);\r\n                n.outputConnectors.push(conn);\r\n                self.paths.appendChild(conn.path);\r\n\r\n\r\n                if (end2.options.isCollection) {\r\n                    end2.cloneLastValue();\r\n                }\r\n                let val = end2.findValue(cn.valueTo);\r\n                val.inputConnector = conn;\r\n                conn.end2 = val;\r\n                val.updateConectorPosition();\r\n            });\r\n        });\r\n    }\r\n\r\n    clear() {\r\n\t\t[].concat(this.nodes).forEach(function (node) {\r\n\t\t\tnode.remove();\r\n\t\t});\r\n        this.paths.innerHTML = \"\";\r\n    };\r\n\r\n    getTerminalNodes () {\r\n\t\treturn this.nodes.filter(function (n) {\r\n\t\t\treturn n.outputConnectors.length === 0;\r\n\t\t});\r\n\t};\r\n\r\n    getOfType(type: string): Node[] {\r\n        return this.nodes.filter(function (n) {\r\n\t\t\treturn n.options.type.id === type;\r\n\t\t});\r\n    }\r\n}"]}