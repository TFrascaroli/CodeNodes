{"version":3,"sources":["nodecanvas.ts"],"names":[],"mappings":"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","file":"nodecanvas.js","sourcesContent":["import * as svgPanZoom from \"svg-pan-zoom\";\r\nimport {Point} from \"./point\";\r\nimport {Node} from \"./node\";\r\nimport {NodeConnector} from \"./nodeconnector\";\r\n\r\nconst namespace = \"http://www.w3.org/2000/svg\";\r\n\r\nexport class NodeCanvas {\r\n\r\n    private pt: SVGPoint;\r\n    public svg: SVGSVGElement;\r\n    private nodes: Array<Node>;\r\n    private currentConnector: NodeConnector;\r\n    private g: SVGGElement;\r\n    private paths: SVGGElement;\r\n    private draggingEntity: Node;\r\n    private diff: Point;\r\n    private zoomingSvg: SvgPanZoom.Instance;\r\n\r\n    constructor () {\r\n        this.svg = null;\r\n        this.g = null;\r\n        this.paths = null;\r\n        this.nodes = [];\r\n        this.pt = null;\r\n        this.draggingEntity = null;\r\n        this.currentConnector = null;\r\n        this.diff = null;\r\n    }\r\n\r\n    cursorPoint(evt) {\r\n        this.pt.x = evt.clientX;\r\n        this.pt.y = evt.clientY;\r\n        return this.pt.matrixTransform(this.svg.getScreenCTM().inverse());\r\n    };\r\n\r\n    render() {\r\n        let self = this;\r\n        if (!this.svg) {\r\n            this.svg = document.createElementNS(namespace, \"svg\");\r\n            this.svg.setAttribute(\"class\", \"codenodes\");\r\n            this.pt = this.svg.createSVGPoint();\r\n            this.svg.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns\", namespace);\r\n            this.svg.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\r\n            this.svg.setAttribute(\"width\", \"100%\");\r\n            this.svg.setAttribute(\"height\", \"100%\");\r\n            this.g = document.createElementNS(namespace, \"g\");\r\n            this.paths = document.createElementNS(namespace, \"g\");\r\n            this.g.classList.add(\"svg-pan-zoom_viewport\");\r\n            this.g.setAttribute(\"transform\", \"matrix(1,1,1,1,0,0)\");\r\n            this.g.appendChild(this.paths);\r\n            this.svg.appendChild(this.g);\r\n        }\r\n        this.nodes.forEach(function(node) {\r\n            node.render(self.g);\r\n        });\r\n    };\r\n\r\n    addNode (title, builder, schema, type, clonable, clonefn, x, y) {\r\n        var n = new Node(title, builder, schema, type, clonable, clonefn, x, y),\r\n            self = this,\r\n            ctm = null,\r\n            offset = null;\r\n\r\n        function convertCoords(o) {\r\n            var x = o.x,\r\n                y = o.y;\r\n            return {\r\n                x: (ctm.a * x) + (ctm.c * y) + ctm.e - offset.left,\r\n                y: (ctm.b * x) + (ctm.d * y) + ctm.f - offset.top\r\n            };\r\n        }\r\n\r\n        function mouseMoveHandler(evt) {\r\n            if (self.draggingEntity) {\r\n                var p = self.cursorPoint(evt);\r\n                p.x = p.x - self.diff.x;\r\n                p.y = p.y - self.diff.y;\r\n                let p1 = convertCoords(p);\r\n                self.draggingEntity.move(p1.x, p1.y);\r\n            }\r\n        }\r\n\r\n        function mouseUpHandler(evt) {\r\n            self.svg.removeEventListener(\"mousemove\", mouseMoveHandler);\r\n            self.svg.removeEventListener(\"mouseup\", mouseUpHandler);\r\n            mouseMoveHandler(evt);\r\n            self.draggingEntity = null;\r\n        }\r\n\r\n        function mouseMoveConnectorHandler(evt) {\r\n            var p = convertCoords(self.cursorPoint(evt));\r\n            self.currentConnector.moveEndPoint(p);\r\n        }\r\n\r\n        function mouseUpConnectorHandler(evt) {\r\n            var p = convertCoords(self.cursorPoint(evt));\r\n            self.svg.removeEventListener(\"mousemove\", mouseMoveConnectorHandler);\r\n            self.svg.removeEventListener(\"mouseup\", mouseUpConnectorHandler);\r\n            var dots = [].slice.call(document.querySelectorAll(\".codenodes .dot\"));\r\n            var candidates = dots.map(function(dot) {\r\n                var pos = dot.parentValue.getDotPosition();\r\n                var dist = Math.sqrt(Math.pow(p.x - pos.x, 2) + Math.pow(p.y - pos.y, 2));\r\n                return {\r\n                    dist: dist,\r\n                    dot: dot\r\n                };\r\n            }).filter(function(dot) {\r\n                return dot.dist <= 30;\r\n            }).sort(function(a, b) {\r\n                return a.dist - b.dist;\r\n            });\r\n            if (candidates.length > 0) {\r\n                if (candidates[0].dot.parentValue.inputConnector) {\r\n                    candidates[0].dot.parentValue.inputConnector.remove();\r\n                }\r\n                candidates[0].dot.parentValue.inputConnector = self.currentConnector;\r\n                self.currentConnector.end2 = candidates[0].dot.parentValue;\r\n                if (self.currentConnector.end2.type !== \"any\" && (self.currentConnector.end2.type !== self.currentConnector.end1.type)) {\r\n                    self.currentConnector.remove();\r\n                }\r\n                if (self.currentConnector.end1 === candidates[0].dot.parentValue.parentNode) {\r\n                    self.currentConnector.remove();\r\n                }\r\n                candidates[0].dot.parentValue.updateConectorPosition();\r\n            } else {\r\n                self.currentConnector.remove();\r\n            }\r\n            self.currentConnector = null;\r\n        }\r\n\r\n        this.nodes.push(n);\r\n        n.outputMousedown = function(evt, entity) {\r\n            var p = self.cursorPoint(evt);\r\n            ctm = self.g.getCTM().inverse();\r\n            offset = self.svg.getBoundingClientRect();\r\n            let p1 = {\r\n                x: entity.position.x + parseInt(entity.output.getAttribute(\"cx\")),\r\n                y: entity.position.y + parseInt(entity.output.getAttribute(\"cy\"))\r\n            }\r\n            self.currentConnector = new NodeConnector(p1, entity);\r\n            entity.outputConnectors.push(self.currentConnector);\r\n            self.paths.appendChild(self.currentConnector.path);\r\n            self.svg.addEventListener(\"mousemove\", mouseMoveConnectorHandler);\r\n            self.svg.addEventListener(\"mouseup\", mouseUpConnectorHandler);\r\n            evt.stopPropagation();\r\n        };\r\n        n.onmousedown = function(evt, entity) {\r\n            var p = self.cursorPoint(evt);\r\n            ctm = self.g.getCTM();\r\n            offset = self.svg.getBoundingClientRect();\r\n            var entPos = convertCoords(entity.position);\r\n            self.diff = {\r\n                x: p.x - entPos.x,\r\n                y: p.y - entPos.y\r\n            };\r\n            ctm = ctm.inverse();\r\n            evt.stopPropagation();\r\n            self.draggingEntity = entity;\r\n            if (self.draggingEntity) {\r\n                self.svg.addEventListener(\"mousemove\", mouseMoveHandler);\r\n                self.svg.addEventListener(\"mouseup\", mouseUpHandler);\r\n            }\r\n        }.bind(this);\r\n        n.onremove = function() {\r\n            n.outputMousedown = null;\r\n            n.onmousedown = null;\r\n            var ind = self.nodes.indexOf(n);\r\n            if (ind >= 0) {\r\n                self.nodes.splice(ind, 1);\r\n            }\r\n            self.g.removeChild(n.g);\r\n        }\r\n    };\r\n\r\n    init () {\r\n        this.svg.setAttribute(\"viewBox\", \"0 0 \" + this.svg.clientWidth + \" \" + this.svg.clientHeight);\r\n        this.zoomingSvg = svgPanZoom(this.svg, {\r\n            zoomScaleSensitivity: 0.4,\r\n            dblClickZoomEnabled: false\r\n        });\r\n    };\r\n\r\n    clear() {\r\n\t\t//Alert the user about the action being irreversible\r\n\t\tvar nds = [].concat(this.nodes);\r\n\t\tnds.forEach(function (node) {\r\n\t\t\tnode.remove();\r\n\t\t});\r\n    };\r\n\r\n    getTerminalNodes () {\r\n\t\treturn this.nodes.filter(function (n) {\r\n\t\t\treturn n.outputConnectors.length === 0;\r\n\t\t});\r\n\t};\r\n}"]}